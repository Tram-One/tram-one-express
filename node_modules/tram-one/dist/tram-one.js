!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["tram-one"]={})}(this,(function(e){"use strict";const t="tram-hook-key",r="tram-effect-store",n="tram-effect-queue",o="tram-key-store",s="tram-key-queue",c="tram-observable-store",a="tram-mutation-observer",i=()=>{if(!window["tram-space"])throw new Error("\n\t\t\tTram-One: app has not started yet, but hook was called. Is it being invoked outside a component function?\n\t\t\thttps://github.com/Tram-One/tram-one/issues/178\n\t\t");return window},l=e=>({setup:t=>{const r=i();return r["tram-space"][t]=e(),r["tram-space"][t]},get:e=>i()["tram-space"][e],set:(e,t)=>{i()["tram-space"][e]=t}}),{setup:u,get:d}=l((()=>({branch:[],branchIndices:{"":0}}))),f=e=>d(e).branch.join("/"),h=e=>{d(e).branchIndices[f(e)]+=1},m=e=>{const t=d(e).branchIndices[f(e)];return`${f(e)}[${t}]`},p="tram-tag",b="tram-tag-reaction",g="tram-tag-store-keys",E="tram-tag-new-effects",v="tram-tag-cleanup-effects",{observe:y}=require("@nx-js/observer-util"),N=(e,t)=>t,T=(e,t)=>{const r=(e=>t=>"tagName"in t&&t.tagName===e?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP)(t),n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,r),o=[n.currentNode];for(;n.nextNode();)o.push(n.currentNode);return o},w={index:-1,tagName:"",scrollLeft:0,scrollTop:0,selectionStart:null,selectionEnd:null,selectionDirection:void 0};var O=e=>{let t;const r=y((()=>{let r=t,n=w;if(r){n=w;if(r.contains(document.activeElement)){const e=document.activeElement,t=T(r,e.tagName);n.index=t.findIndex((t=>t===e)),n.tagName=e.tagName,n.scrollLeft=e.scrollLeft,n.scrollTop=e.scrollTop,n.selectionStart=e.selectionStart,n.selectionEnd=e.selectionEnd,n.selectionDirection=e.selectionDirection||void 0}const e=document.createElement("div");r.replaceWith(e),e[b]=r[b],e[E]=r[E],e[v]=r[v],r=e}if(t=e(),r){let e;if(n.index>=0){const r=T(t,n.tagName),s=r.map(N).sort((o=n.index,(e,t)=>Math.abs(e-o)-Math.abs(t-o)))[0];e=r[s];try{void 0!==e.setSelectionRange&&e.setSelectionRange(n.selectionStart,n.selectionEnd,n.selectionDirection)}catch(e){}e.scrollLeft=n.scrollLeft,e.scrollTop=n.scrollTop}t[p]=!0,t[b]=r[b],t[E]=r[E],t[v]=r[v],r.replaceWith(t),e&&e.focus&&e.focus()}var o}));if(void 0===t)throw new Error("\n\t\t\tTram-One: tagResult was not defined after building the tag.\n\t\t\thttps://github.com/Tram-One/tram-one/issues/177\n\t\t");return t[b]=r,t};const{setup:I,get:k,set:S}=l((()=>({}))),j=S,{setup:x,get:L,set:q}=l((()=>[])),F=q;var M=e=>{const t={...k(n)},o=[...L(s)];(e=>{const t=k(e);Object.keys(t).forEach((e=>delete t[e]))})(n),(e=>{const t=L(e);t.splice(0,t.length)})(s);const c=e(),a=k(r),i=k(n),l=L(s),u=Object.keys(i).filter((e=>!(e in a)));return c[E]=u.map((e=>i[e])),c[g]=l,j(n,t),F(s,o),c};const C=require("@tram-one/nanohtml"),_=require("@tram-one/rbel"),P=require("@tram-one/hyperx"),R=(e,r={})=>{const n=Object.keys(r).reduce(((e,n)=>{const o=r[n];return{...e,[n]:(e,r)=>{const s=JSON.stringify(e);((e,t)=>{const r=d(e);r.branch.push(t),r.branchIndices[f(e)]||(r.branchIndices[f(e)]=0)})(t,`${n}[${s}]`),h(t);const c=(e=>{const t=d(e);return{branch:[...t.branch],branchIndices:{...t.branchIndices}}})(t),a=()=>(((e,t)=>{const r=d(e),n=r.branchIndices;r.branch=[...t.branch],Object.keys(r.branchIndices).forEach((e=>{n[e]=t.branchIndices[e]||0}))})(t,c),o(e,r)),i=O((()=>M(a)));return d(t).branch.pop(),i[p]=!0,i[E]=i[E]||[],i[v]=i[E]||[],i}}}),{});return _(P,C(e),n)},W=e=>R(null,e);const{observable:$}=require("@nx-js/observer-util"),{setup:A,get:D}=l((()=>$({})));var H=(e,r)=>{const n=D(c);h(t);const o=e||m(t);Object.prototype.hasOwnProperty.call(n,o)||void 0===r||(n[o]=Array.isArray(r)?[...r]:{...r});const a=n[o];return!e&&L(s).push(o),a},K=e=>H(void 0,e);const G=require("url-listener"),J=require("use-url-params");var U=e=>{const t=(e=>{if("string"==typeof e){const t=document.querySelector(e);if(null===t)throw new Error("\n\t\t\t\tTram-One: could not find target, is the element on the page yet?\n\t\t\t\thttps://github.com/Tram-One/tram-one/issues/179\n\t\t\t");return t}return e})(e);if(!t.firstElementChild){const e=document.createElement("div");t.appendChild(e)}return t};const{setup:z,get:B,set:Q}=l((()=>({}))),{observe:V,unobserve:X}=require("@nx-js/observer-util"),Y=e=>{if(!(p in e))return;e[g]&&e[g].forEach((e=>{((e,t)=>{const r=B(e);r[t]=r[t]+1||1})(o,e)}));e[E]&&(e[v]=[],e[E].forEach((t=>{let r;const n=V((()=>{"function"==typeof r&&r(),r=t()}));e[v].push((()=>{"function"==typeof r&&r(),X(n)}))})),e[E]=[])},Z=e=>{e.forEach((e=>{var t;t=e,B(o)[t]--}))},ee=e=>{p in e&&(X(e[b]),(e=>{e.forEach((e=>e()))})(e[v]),Z(e[g]))},te=e=>p in e?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP,re=e=>{const t=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,te),r=[];for(;t.nextNode();)r.push(t.currentNode);return r},{setup:ne,get:oe}=l((()=>new MutationObserver((e=>{e.flatMap((e=>[...e.removedNodes])).flatMap(re).forEach(ee);e.flatMap((e=>[...e.addedNodes])).flatMap(re).forEach(Y),(()=>{const e=D(c),t=B(o);Object.entries(t).forEach((([r,n])=>{0===n&&(delete e[r],delete t[r])}))})()}))));e.registerHtml=W,e.registerSvg=e=>R("http://www.w3.org/2000/svg",e),e.start=(e,i)=>{const l=U(i);var d;window["tram-space"]={},I(r),I(n),u(t),A(c),z(o),x(s),ne(a),d=l,oe(a).observe(d,{childList:!0,subtree:!0}),((e,t)=>{const r=W({app:e})`<div><app /></div>`;t.replaceChild(r,t.firstElementChild)})(e,l)},e.useEffect=e=>{const r=k(n),o=m(t);h(t);r[`${o}()`]=e},e.useGlobalStore=function(e,t){return H(e,t)},e.useStore=K,e.useUrlParams=e=>{const t=J(e),r=K(t);return G((()=>{const n=J(e);[...Object.keys(t),...Object.keys(n)].forEach((e=>{r[e]=n[e]}))})),r},Object.defineProperty(e,"__esModule",{value:!0})}));
